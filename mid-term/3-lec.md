# lec 8 虚拟存储

解决内存不够用的问题

##### 覆盖

应用程序手动把需要的指令和数据保存在内存中

##### 交换

操作系统自动把暂时不能执行的程序保存到外存

##### 虚拟存储

在有限容量的内存中，以页为单位自动装入更大程序

## 覆盖技术

将程序划分为若干功能独立的模块，将不会同时执行的模块共享一块内存趋于

必要部分常驻内存

可选部分志在需要时装入内存

不存在调用关系的模块可以相互覆盖，共享同一块内存区域

> **只要不同时执行，没有调用关系即可共享**

##### 不足

需要程序员划分功能模块，编程更复杂

时间换空间

## 交换技术

将暂时不能运行的程序放到外存

基本单位：整个进程的地址空间

只当内存不够时或可能不够时换出

## 虚拟存储

只交换进程的部分内容

局部性原理：时间、空间、分支

### 虚拟页式存储

在页式存储基础上，添加请求调页和页面置换

# lec9 页面置换算法

## OPT 最优页面置换算法

替换未来最长时间不访问的页面

需要计算每个逻辑页面的下一次访问时间

无法实现

## 先进先出算法

替换在内存驻留时间最长的页面

## 最近最未被使用算法 LRU

置换最长时间没被使用的页面

页表中无法记录访问时间，因此也精确实现

可以用栈来实现

## 时钟替换算法 改进的clock算法

访问位，修改位

## LFU 最不常用算法

需要对每一个页进行访问计数

## BELADY 现象

物理页面增加，却也次数反而升高（FIFO）

置换特征与进程访问内存的动态特征矛盾

LRU没有该现象，LRU需要动态调整顺序

CLOCK是他们的折中，也有Belady现象，当所有页访问位都为1时，会退化为FIFO

## 全局置换算法

为进程分配可变数目的物理页面

## CPU利用率与并发进程数

一开始成正比，后来反比，因为CPU将大多数时间花在了内存换入换出上

## 工作集置换算法

换出不在工作集中的页面

### 工作集

取窗口长度t，在t时间内访问过的页面集合

### 常驻集

当前时刻，进程实际驻留在内存中的页面集合

## 缺页率置换算法

通过调节常驻集大小，使进程缺页率保持在一个合理范围

## 抖动问题

进程物理页面大小小于工作集

# LEC10 lab3

CR2 记录了异常的线性地址

ucore中段机制是对等映射，虚拟地址和线性地址相同